---
title: "MPG Transmission"
author: "Joohyun Kwon"
date: "April 5, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#Executive Summary
We are interested in analyzing various factors that influence gas mileage (MPG - Mile Per Gallon) of a car. Particulary we will look at the influence of transmission type on gas mileage. We collected various data from 33 cars and analyzed them in order to answer below questions:

- Is an automatic or manual transmission better for MPG
- What is MPG difference between those two transmission types

A simple t-test shows that there is significant difference in average MPG between those two groups - one with automatic transmission, the other with manua. We also build a regression model with tranmission type and hp as regressors. This model shows that there is average 5.28 MPG increase in cars with manual transmission compared with those with automatic transmission.

#Data Process
We load data and briefly examine them.
```{r}
#load mtcars data
data(mtcars)
str(mtcars)
head(mtcars)
tail(mtcars)
```
It appears that some columns appear to be categorical - am, cyl, vs, carb. We will later modify the type of those columns to factor from number.

Let's make some columns to factor so that we can build model more easily.
```{r}
mtcars.f = mtcars
mtcars.f$am = as.factor(mtcars.f$am)
#chang level names to automaitc and manual
levels(mtcars.f$am) = c("automatic", "manual")
mtcars.f$cyl = as.factor(mtcars.f$cyl)
mtcars.f$vs = as.factor(mtcars.f$vs)
mtcars.f$gear = as.factor(mtcars.f$gear)
mtcars.f$carb = as.factor(mtcars.f$carb)
```
Let's check correlation of variables.
```{r}
#cor_matrix <- cor(mtcars)
#cor_matrix[c(1,9),]

panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(mtcars.f, lower.panel = panel.smooth, upper.panel = panel.cor,  col = 3 + (mtcars$am == 1))
```

We can see mpg is correlated highly with cyl, disp, hp and wt but less with am. These correspond with our intutition that number of cylider, displacement of engine, HP and Weight will have high impact on MPG.

However, cyl, wt and disp have strong colinearity with am. This will strongly affect the adjustment of linear model between mpg and am, when other variables are considered. We will look at this later and modify our model accordingly.

#Eploratory Data Analysis

```{r}
boxplot(mpg ~ am, data=mtcars, main="Mileage by Transmission Type", ylab="MPG (Mile per Gallon)",
        col=c("lightgreen","lightblue"), names=c("automaitc", "manual"))
```



from the boxplot, we can see cars with manual transmission have on average much higher mpg. Also, more than 75% of cars with manual transmission have higher mpg than 75% of cars with automaitc transmission. It is quite apparent. However, we will investigate how other factors such as displacement, number of cylinder and etc are influencing this.

##Hypothesis
MPG of manual transmission is equal to that of automatic transmission
```{r}
mtcars <- mtcars.f
mean_auto = mean(mtcars[mtcars$am=="automatic",]$mpg)
mean_manual = mean(mtcars[mtcars$am=="manual",]$mpg)
```
Mean MPG of manaual transmission: `r round(mean_manual,2)`
Mean MPG of automatic transmission: `r round(mean_auto,2)` 

###T-test of hypothesis 
This test shows that there is significant difference in MPG between automatic and manaul transmission.
```{r}
mpg_automatic= mtcars[mtcars$am=="automatic",]$mpg
mpg_manual= mtcars[mtcars$am=="manual",]$mpg
mpg_automatic
mpg_manual
t.test(mpg_automatic, mpg_manual)
```

```{r}
with(mtcars, tapply(mpg, am, summary))
fit = lm(mpg ~ am, data=mtcars)
summary(fit)
```

```{r}
#create a vector with mtcars's column names - "am"
x <- names(mtcars)
x <- x[! x == "am" & ! x == "mpg" ]
#tt <- data.frame()
#names(tt) <- c("formula", "coefficient", "P-Value")
for (i in 1:length(x)) {
    fml <- NULL; y <-NULL ; fit_temp <- NULL
    fml <- paste("mpg ~ am + ", x[i] )
    fit_temp <- lm(fml, data=mtcars) 
    y <- c(fml,round(summary(fit_temp)$coefficients[2,1],2),
           round(summary(fit_temp)$coefficients[2,4],2))
    y <- as.character(y); print(y)
   # tt <- rbind(tt,y)
}

```
hp, qsec, vs, carb
```{r}
fit1 = lm(mpg ~ am + hp, data=mtcars)
summary(fit1)
```

```{r}
fit2 = lm(mpg ~ am + hp + qsec, data=mtcars)
summary(fit2)
anova(fit1,fit2)
```

```{r}

fit3 = lm(mpg ~ am + hp + vs, data=mtcars)
summary(fit3)
anova(fit1,fit3)
```

```{r}

fit4 = lm(mpg ~ am + hp + carb, data=mtcars)
summary(fit4)
anova(fit1,fit4)
```

```{r}
fit5 = lm(mpg ~ am + hp + disp, data=mtcars)
summary(fit5)
anova(fit1,fit5)
```

```{r}

fit6 = lm(mpg ~ am + hp + qsec+ vs + carb, data=mtcars)
summary(fit6)
anova(fit1,fit6)
```

```{r}
pairs(mtcars, panel = panel.smooth, col = 3 + (mtcars$am == 1))
```

```{r}
par(mfrow=c(1,3))
with(mtcars, plot(disp, mpg, col=am))
with(mtcars, plot(hp, mpg, col=am))
with(mtcars, plot(wt, mpg, col=am))
```
Let's have a look at the coefficient of type of transmission when all the variables are taken as regressor.
```{r}
fitAll <- lm(mpg ~ ., data=mtcars)
summary(fitAll)
library(car)
vif(fitAll)
```



```{r}
fit_cyl_carb = lm(mpg ~ . - cyl - carb, data=mtcars)
anova(fitAll,fit_cyl_carb)
fit_l = lm(mpg ~ am + disp + hp +drat + wt + qsec +vs +gear, data=mtcars)
vif(fit_l)
fit_l_g = lm(mpg ~ am + disp + hp +drat + wt + qsec +vs, data=mtcars)
anova(fit_l, fit_l_g)
```