---
title: "MPG Transmission"
author: "Joohyun Kwon"
date: "April 5, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#Executive Summary

We are interested in analyzing various factors that influence gas mileage (MPG - Mile Per Gallon) of a car. Particulary we will look at the influence of transmission type on gas mileage. We collected various data from 33 cars and analyzed them in order to answer below questions:

- Is an automatic or manual transmission better for MPG
- What is MPG difference between those two transmission types

A simple t-test shows that there is significant difference in average MPG between those two groups - one with automatic transmission, the other with manua. We also build a linear regression model where it includes as many variables as possible while keeping coefficient for am variable statistically significant. We could include only am (tranmission type) and hp as predictors in this model. This model shows that there is average 5.28 MPG increase in cars with manual transmission compared with those with automatic transmission.

However, there is not enough data that could explain the exact effect of transmission type on MPG. Variables such as wt, disp and cyl should be included in the model since they have higher correlation with mpg than hp or am. But the inclusion of any of those render am coefficient insignificant. For the investigation of exact impact of transmission type on MPG, more data or other types of data should be collected. For example, some data collected from cars that has only difference in transmission would provide a good data for this investigation

In conclusion, there is high correlation between transmission type and MPG. However, with current data, we can't conclusively propose the amount of MPG difference between manaual and automatic transmission.

#Data Process
We load data and briefly examine them.
```{r}
#load mtcars data
data(mtcars)
```
It appears that some columns appear to be categorical - am, cyl, vs, carb. Lets' make them as factors.

```{r}
mtcars$am = as.factor(mtcars$am)
levels(mtcars$am) = c("automatic", "manual")
mtcars$cyl = as.factor(mtcars$cyl)
mtcars$vs = as.factor(mtcars$vs)
mtcars$gear = as.factor(mtcars$gear)
mtcars$carb = as.factor(mtcars$carb)
```
#Eploratory Data Analysis

###Summary of MPG by Transmission Type

```{r}
with(mtcars, tapply(mpg, am, summary))

boxplot(mpg ~ am, data=mtcars, main="Mileage by Transmission Type", ylab="MPG (Mile per Gallon)",
        col=c("lightgreen","lightblue"), names=c("automaitc", "manual"))
```

From the boxplot, we can see cars with manual transmission have on average much higher mpg than automatic. We will test if this hypothesis is true and also we will investigate how other factors such as weight, number of cylinder and etc are influencing MPG of cars.

###Hypothesis

We propose an hypothesis thtat MPG of manual transmission is greater than that of automatic transmission. 
We will run a t-test to see if our data reject the null hypotheis where MPG of manual transmission is equal to that of automatic transmission.

```{r echo=FALSE,message=FALSE}
mpg_automatic= mtcars[mtcars$am=="automatic",]$mpg ;mpg_manual= mtcars[mtcars$am=="manual",]$mpg
```

Mean MPG of manaual transmission: **`r round(mean(mpg_manual),2)`**

Mean MPG of automatic transmission: **`r round(mean(mpg_automatic),2)`** 

The difference of average MPG between automatic and manaul transmission: **`r round(mean(mpg_manual),2) -round(mean(mpg_automatic),2)`** 

###T-test of hypothesis 
This test shows that the difference in MPG between automatic and manaul transmission is statistically siginificant.

```{r}
t.test(mpg_automatic, mpg_manual)
```

#Model Buiding
###Variable Selection

We use stepAIC in order to select variables for model using stepwise selection methods.

```{r message=FALSE}
fitAll = lm(mpg ~ ., mtcars)
library(MASS)
bestFit = stepAIC(fitAll, direction="both")
```

```{r}
summary(bestFit)
```

StepAIC function selects **cyl**, **hp** and **wt** along with **am** as the predictors for our linear regression model.

###Model Interpretation

As the summary output shows. This regression model explains 87% of variations (R-squared) with P-value (1.506e-10) that is much lower than 0.05.

The coefficient of ammanual (1.81) is the increase of MPG if the transmission becomes manual from automatic while holding the other variables as is. That is the difference of MPG between manual and automatic transmission.

However, the P-value (0.21) for ammanual coefficient is much larger than the cut-value of 0.05. Thus the coefficient is statistically insignificant and we cannot reject the hypothesis that this coefficeint is zero.





#Review Remark

###Correlation Matrix

```{r}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(mtcars, lower.panel = panel.smooth, upper.panel = panel.cor,  col = 3 + (mtcars$am == "manual"))
```

We can see mpg is highly correlated with cyl, disp, hp and wt but less with am. Disp is also strongly correlated with hp and wt, which is probably why disp is not included in the regression model that we select through stepwise selection. Am is relatively weakly correlated (cor=0.6) with mpg and rather strongly correlated with wt and cyl, which is why, in the final model, the variance of am coefficient becomes so large that P-value gets larger than 0.5 and the coefficient gets statistically insignificant.


```{r}
#par(mfrow=c(1,3))
#with(mtcars, plot(cyl, mpg, col=3+(am=="automatic"), pch=19))
with(mtcars, plot(hp, mpg, col=3+(am=="automatic"), pch=19))
#with(mtcars, plot(am, wt))
with(mtcars, plot(wt, mpg, col=3+(am=="automatic"), pch=19))
```

###Residual Plots
```{r}
plot(bestFit)
```


